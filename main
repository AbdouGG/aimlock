local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local Camera = workspace.CurrentCamera
local TweenService = game:GetService("TweenService")

-- Variables to track FPS
local lastUpdate = tick()
local frameCount = 0

-- Configuration
local Config = {
    WindowName = "Nurk Hub | V1.6.6",
    DiscordInvite = "https://discord.com/invite/8ub8UQNzbT",
    AimbotKey = Enum.KeyCode.Q,
    ESPColor = Color3.fromRGB(255, 0, 0),
    AimbotSmoothness = 0.2, -- Lowered default for better control
    AimbotFOV = 150,        -- Increased default FOV to make testing easier
    AimbotTargetPart = "Head",
    FOVColor = Color3.fromRGB(255, 255, 255),
    FOVThickness = 1,
    FOVTransparency = 0.7,
    TeamCheck = false,
    WallCheck = true,
    ESPBoxes = true,
    ESPNames = true,
    ESPDistance = false,
    ESPHealth = false,
    ESPTracer = false,
    MaxESPDistance = 1000,
    IgnoreDeadPlayers = true,
    MinTrackingSpeed = 0.2,
    MaxTrackingSpeed = 2.0,
    AccelerationWeight = 0.7,
    VelocityHistory = 5,
    TeamColor = Color3.fromRGB(0, 255, 0),
    EnemyColor = Color3.fromRGB(255, 0, 0),
    RainbowFOV = false,
    RainbowESP = false,
    RandomTargetPart = false,
    RandomTargetPartInterval = 0.25,
    CustomTargetParts = {},
    UseCustomParts = false,
    BlacklistedPlayers = {},
    UseBlacklist = false,
    ShowQuickAccess = true, -- Enabled by default for mobile users
    UseHealthThreshold = false,
    HealthThreshold = 20,
    PingPrediction = true,
    AutoPrediction = true,
    
    -- CROSSHAIR SETTINGS
    ShowCrosshair = false,
    CrosshairSize = 10,
    CrosshairThickness = 2,
    CrosshairGap = 5,
    CrosshairColor = Color3.fromRGB(255, 255, 255),
    CrosshairTransparency = 1,
    RainbowCrosshair = false
}

-- State
local State = {
    AimbotActive = false,
    TargetPlayer = nil,
    ESPEnabled = false,
    FOVCircle = nil,
    ESPObjects = {},
    VelocityBuffer = {},
    LastTargetPosition = nil,
    LastUpdateTime = tick(),
    RainbowHue = 0,
    CurrentRandomPart = nil,
    LastRandomPartUpdate = 0,
    LastTargetPlayer = nil,
    CrosshairLines = {}
}

-- Forward declarations
local QuickAimbotButton
local QuickStatusLabel
local QuickGradient
local QuickBorder

-- Create Custom UI
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "NurkHubUI"
ScreenGui.ResetOnSpawn = false
ScreenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
ScreenGui.IgnoreGuiInset = true 

-- SCALING UTILITY
local function MakeDraggable(guiObject, dragFrame)
    local dragging = false
    local dragInput, dragStart, startPos

    local function update(input)
        local delta = input.Position - dragStart
        local scale = guiObject:FindFirstChild("UIScale") and guiObject.UIScale.Scale or 1
        guiObject.Position = UDim2.new(
            startPos.X.Scale, 
            startPos.X.Offset + (delta.X / scale), 
            startPos.Y.Scale, 
            startPos.Y.Offset + (delta.Y / scale)
        )
    end

    dragFrame.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
            dragging = true
            dragStart = input.Position
            startPos = guiObject.Position

            input.Changed:Connect(function()
                if input.UserInputState == Enum.UserInputState.End then
                    dragging = false
                end
            end)
        end
    end)

    dragFrame.InputChanged:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then
            dragInput = input
        end
    end)

    UserInputService.InputChanged:Connect(function(input)
        if input == dragInput and dragging then
            update(input)
        end
    end)
end

local MainFrame = Instance.new("Frame")
MainFrame.Name = "MainFrame"
MainFrame.Parent = ScreenGui
MainFrame.BackgroundColor3 = Color3.fromRGB(15, 15, 15)
MainFrame.BorderSizePixel = 0
MainFrame.AnchorPoint = Vector2.new(0.5, 0.5)
MainFrame.Position = UDim2.new(0.5, 0, 0.5, 0)
MainFrame.Size = UDim2.new(0, 350, 0, 450)
MainFrame.Active = true

local MainScale = Instance.new("UIScale")
MainScale.Parent = MainFrame
MainScale.Scale = 1

local UICorner = Instance.new("UICorner")
UICorner.CornerRadius = UDim.new(0, 8)
UICorner.Parent = MainFrame

local Border = Instance.new("UIStroke")
Border.Color = Color3.fromRGB(60, 60, 60)
Border.Thickness = 1
Border.Parent = MainFrame

local TitleBar = Instance.new("Frame")
TitleBar.Name = "TitleBar"
TitleBar.Parent = MainFrame
TitleBar.BackgroundColor3 = Color3.fromRGB(20, 20, 20)
TitleBar.BorderSizePixel = 0
TitleBar.Size = UDim2.new(1, 0, 0, 45)

MakeDraggable(MainFrame, TitleBar)

local TitleCorner = Instance.new("UICorner")
TitleCorner.CornerRadius = UDim.new(0, 8)
TitleCorner.Parent = TitleBar

local Title = Instance.new("TextLabel")
Title.Name = "Title"
Title.Parent = TitleBar
Title.BackgroundTransparency = 1
Title.Position = UDim2.new(0, 15, 0, 0)
Title.Size = UDim2.new(1, -50, 1, 0)
Title.Font = Enum.Font.GothamBold
Title.Text = "NURK HUB"
Title.TextColor3 = Color3.fromRGB(255, 255, 255)
Title.TextSize = 16
Title.TextXAlignment = Enum.TextXAlignment.Left

local Version = Instance.new("TextLabel")
Version.Parent = TitleBar
Version.BackgroundTransparency = 1
Version.Position = UDim2.new(0, 95, 0, 0)
Version.Size = UDim2.new(0, 50, 1, 0)
Version.Font = Enum.Font.Gotham
Version.Text = "v1.6.6"
Version.TextColor3 = Color3.fromRGB(150, 150, 150)
Version.TextSize = 11
Version.TextXAlignment = Enum.TextXAlignment.Left

local CloseButton = Instance.new("TextButton")
CloseButton.Name = "CloseButton"
CloseButton.Parent = TitleBar
CloseButton.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
CloseButton.BorderSizePixel = 0
CloseButton.Position = UDim2.new(1, -35, 0.5, -12.5)
CloseButton.Size = UDim2.new(0, 25, 0, 25)
CloseButton.Font = Enum.Font.GothamBold
CloseButton.Text = "Ã—"
CloseButton.TextColor3 = Color3.fromRGB(200, 200, 200)
CloseButton.TextSize = 18

local CloseCorner = Instance.new("UICorner")
CloseCorner.CornerRadius = UDim.new(0, 4)
CloseCorner.Parent = CloseButton

local TabsContainer = Instance.new("Frame")
TabsContainer.Name = "TabsContainer"
TabsContainer.Parent = MainFrame
TabsContainer.BackgroundTransparency = 1
TabsContainer.Position = UDim2.new(0, 10, 0, 55)
TabsContainer.Size = UDim2.new(1, -20, 0, 35)

local TabsLayout = Instance.new("UIListLayout")
TabsLayout.Parent = TabsContainer
TabsLayout.FillDirection = Enum.FillDirection.Horizontal
TabsLayout.SortOrder = Enum.SortOrder.LayoutOrder
TabsLayout.Padding = UDim.new(0, 8)

local ContentFrame = Instance.new("ScrollingFrame")
ContentFrame.Name = "ContentFrame"
ContentFrame.Parent = MainFrame
ContentFrame.BackgroundTransparency = 1
ContentFrame.Position = UDim2.new(0, 15, 0, 100)
ContentFrame.Size = UDim2.new(1, -30, 1, -115)
ContentFrame.ScrollBarThickness = 6
ContentFrame.BorderSizePixel = 0
ContentFrame.CanvasSize = UDim2.new(0, 0, 0, 0)
ContentFrame.ScrollBarImageColor3 = Color3.fromRGB(80, 80, 80)
ContentFrame.ScrollingEnabled = true
ContentFrame.ClipsDescendants = true

local ContentLayout = Instance.new("UIListLayout")
ContentLayout.Parent = ContentFrame
ContentLayout.SortOrder = Enum.SortOrder.LayoutOrder
ContentLayout.Padding = UDim.new(0, 10)

local function CreateSection(name, parent)
    local section = Instance.new("TextLabel")
    section.Name = name .. "Section"
    section.Parent = parent
    section.BackgroundTransparency = 1
    section.Size = UDim2.new(1, 0, 0, 20)
    section.Font = Enum.Font.GothamBold
    section.Text = name
    section.TextColor3 = Color3.fromRGB(200, 200, 200)
    section.TextSize = 13
    section.TextXAlignment = Enum.TextXAlignment.Left
    return section
end

local Tabs = {}
local CurrentTab = nil

local function CreateTab(name)
    local tab = {}
    local tabButton = Instance.new("TextButton")
    tabButton.Name = name .. "Tab"
    tabButton.Parent = TabsContainer
    tabButton.BackgroundColor3 = Color3.fromRGB(25, 25, 25)
    tabButton.BorderSizePixel = 0
    tabButton.Size = UDim2.new(0, 60, 1, 0)
    tabButton.Font = Enum.Font.Gotham
    tabButton.Text = name
    tabButton.TextColor3 = Color3.fromRGB(120, 120, 120)
    tabButton.TextSize = 11
    tabButton.AutoButtonColor = false
    
    local tabCorner = Instance.new("UICorner")
    tabCorner.CornerRadius = UDim.new(0, 4)
    tabCorner.Parent = tabButton
    
    local tabContent = Instance.new("Frame")
    tabContent.Name = name .. "Content"
    tabContent.Parent = ContentFrame
    tabContent.BackgroundTransparency = 1
    tabContent.Size = UDim2.new(1, 0, 0, 0) 
    tabContent.Visible = false
    
    local tabLayout = Instance.new("UIListLayout")
    tabLayout.Parent = tabContent
    tabLayout.SortOrder = Enum.SortOrder.LayoutOrder
    tabLayout.Padding = UDim.new(0, 10)
    
    tab.Button = tabButton
    tab.Content = tabContent
    tab.Layout = tabLayout
    
    -- FORCE SCROLL UPDATE
    RunService.RenderStepped:Connect(function()
        if tabContent.Visible then
            ContentFrame.CanvasSize = UDim2.new(0, 0, 0, tabLayout.AbsoluteContentSize.Y + 350)
        end
    end)
    
    tabButton.MouseButton1Click:Connect(function()
        for _, t in pairs(Tabs) do
            t.Content.Visible = false
            t.Button.BackgroundColor3 = Color3.fromRGB(25, 25, 25)
            t.Button.TextColor3 = Color3.fromRGB(120, 120, 120)
        end
        
        tabContent.Visible = true
        tabButton.BackgroundColor3 = Color3.fromRGB(45, 45, 45)
        tabButton.TextColor3 = Color3.fromRGB(255, 255, 255)
        CurrentTab = tab
        
        ContentFrame.CanvasPosition = Vector2.new(0, 0)
    end)
    
    Tabs[name] = tab
    return tab
end

-- ... [Rest of the UI Helper functions: CreateToggle, CreateSlider, etc. remain identical]
local function CreateToggle(name, default, callback, parent)
    local toggleFrame = Instance.new("Frame")
    toggleFrame.Name = name .. "Toggle"
    toggleFrame.Parent = parent
    toggleFrame.BackgroundColor3 = Color3.fromRGB(22, 22, 22)
    toggleFrame.BorderSizePixel = 0
    toggleFrame.Size = UDim2.new(1, 0, 0, 32)
    
    local toggleCorner = Instance.new("UICorner")
    toggleCorner.CornerRadius = UDim.new(0, 4)
    toggleCorner.Parent = toggleFrame
    
    local label = Instance.new("TextLabel")
    label.Parent = toggleFrame
    label.BackgroundTransparency = 1
    label.Position = UDim2.new(0, 12, 0, 0)
    label.Size = UDim2.new(0.7, 0, 1, 0)
    label.Font = Enum.Font.Gotham
    label.Text = name
    label.TextColor3 = Color3.fromRGB(220, 220, 220)
    label.TextSize = 12
    label.TextXAlignment = Enum.TextXAlignment.Left
    
    local switchBg = Instance.new("Frame")
    switchBg.Parent = toggleFrame
    switchBg.BackgroundColor3 = default and Color3.fromRGB(60, 60, 60) or Color3.fromRGB(35, 35, 35)
    switchBg.BorderSizePixel = 0
    switchBg.Position = UDim2.new(1, -50, 0.5, -10)
    switchBg.Size = UDim2.new(0, 40, 0, 20)
    
    local switchCorner = Instance.new("UICorner")
    switchCorner.CornerRadius = UDim.new(1, 0)
    switchCorner.Parent = switchBg
    
    local switchButton = Instance.new("Frame")
    switchButton.Parent = switchBg
    switchButton.BackgroundColor3 = default and Color3.fromRGB(200, 200, 200) or Color3.fromRGB(100, 100, 100)
    switchButton.BorderSizePixel = 0
    switchButton.Position = default and UDim2.new(0, 22, 0.5, -8) or UDim2.new(0, 2, 0.5, -8)
    switchButton.Size = UDim2.new(0, 16, 0, 16)
    
    local switchButtonCorner = Instance.new("UICorner")
    switchButtonCorner.CornerRadius = UDim.new(1, 0)
    switchButtonCorner.Parent = switchButton
    
    local button = Instance.new("TextButton")
    button.Parent = toggleFrame
    button.BackgroundTransparency = 1
    button.Size = UDim2.new(1, 0, 1, 0)
    button.Text = ""
    button.ZIndex = 2
    
    local isEnabled = default
    
    button.MouseButton1Click:Connect(function()
        isEnabled = not isEnabled
        local bgColor = isEnabled and Color3.fromRGB(60, 60, 60) or Color3.fromRGB(35, 35, 35)
        local btnColor = isEnabled and Color3.fromRGB(200, 200, 200) or Color3.fromRGB(100, 100, 100)
        local btnPos = isEnabled and UDim2.new(0, 22, 0.5, -8) or UDim2.new(0, 2, 0.5, -8)
        TweenService:Create(switchBg, TweenInfo.new(0.2), {BackgroundColor3 = bgColor}):Play()
        TweenService:Create(switchButton, TweenInfo.new(0.2), {BackgroundColor3 = btnColor, Position = btnPos}):Play()
        callback(isEnabled)
    end)
    
    return toggleFrame
end

local function CreateSlider(name, min, max, default, callback, parent)
    local sliderFrame = Instance.new("Frame")
    sliderFrame.Name = name .. "Slider"
    sliderFrame.Parent = parent
    sliderFrame.BackgroundColor3 = Color3.fromRGB(22, 22, 22)
    sliderFrame.BorderSizePixel = 0
    sliderFrame.Size = UDim2.new(1, 0, 0, 45)
    local sliderCorner = Instance.new("UICorner")
    sliderCorner.CornerRadius = UDim.new(0, 4)
    sliderCorner.Parent = sliderFrame
    local label = Instance.new("TextLabel")
    label.Parent = sliderFrame
    label.BackgroundTransparency = 1
    label.Position = UDim2.new(0, 12, 0, 5)
    label.Size = UDim2.new(0.6, 0, 0, 15)
    label.Font = Enum.Font.Gotham
    label.Text = name
    label.TextColor3 = Color3.fromRGB(220, 220, 220)
    label.TextSize = 12
    label.TextXAlignment = Enum.TextXAlignment.Left
    local valueLabel = Instance.new("TextLabel")
    valueLabel.Parent = sliderFrame
    valueLabel.BackgroundTransparency = 1
    valueLabel.Position = UDim2.new(0.6, 0, 0, 5)
    valueLabel.Size = UDim2.new(0.4, -12, 0, 15)
    valueLabel.Font = Enum.Font.GothamBold
    valueLabel.Text = tostring(math.floor(default * 100) / 100)
    valueLabel.TextColor3 = Color3.fromRGB(180, 180, 180)
    valueLabel.TextSize = 11
    valueLabel.TextXAlignment = Enum.TextXAlignment.Right
    local sliderBar = Instance.new("Frame")
    sliderBar.Parent = sliderFrame
    sliderBar.BackgroundColor3 = Color3.fromRGB(35, 35, 35)
    sliderBar.BorderSizePixel = 0
    sliderBar.Position = UDim2.new(0, 12, 0, 28)
    sliderBar.Size = UDim2.new(1, -24, 0, 6)
    local sliderBarCorner = Instance.new("UICorner")
    sliderBarCorner.CornerRadius = UDim.new(1, 0)
    sliderBarCorner.Parent = sliderBar
    local sliderFill = Instance.new("Frame")
    sliderFill.Parent = sliderBar
    sliderFill.BackgroundColor3 = Color3.fromRGB(100, 100, 100)
    sliderFill.BorderSizePixel = 0
    sliderFill.Size = UDim2.new((default - min) / (max - min), 0, 1, 0)
    local sliderFillCorner = Instance.new("UICorner")
    sliderFillCorner.CornerRadius = UDim.new(1, 0)
    sliderFillCorner.Parent = sliderFill
    local isDragging = false
    local function updateSlider(position)
        local relativePos = math.clamp((position.X - sliderBar.AbsolutePosition.X) / sliderBar.AbsoluteSize.X, 0, 1)
        local value = min + (max - min) * relativePos
        sliderFill.Size = UDim2.new(relativePos, 0, 1, 0)
        valueLabel.Text = tostring(math.floor(value * 100) / 100)
        callback(value)
    end
    sliderBar.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
            isDragging = true
            updateSlider(input.Position)
            local connection
            connection = input.Changed:Connect(function()
                if input.UserInputState == Enum.UserInputState.End then
                    isDragging = false
                    connection:Disconnect()
                end
            end)
        end
    end)
    UserInputService.InputChanged:Connect(function(input)
        if isDragging and (input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch) then
            updateSlider(input.Position)
        end
    end)
    return sliderFrame
end

local function CreateInput(name, default, callback, parent)
    local inputFrame = Instance.new("Frame")
    inputFrame.Name = name .. "Input"
    inputFrame.Parent = parent
    inputFrame.BackgroundColor3 = Color3.fromRGB(22, 22, 22)
    inputFrame.BorderSizePixel = 0
    inputFrame.Size = UDim2.new(1, 0, 0, 45)
    local inputCorner = Instance.new("UICorner")
    inputCorner.CornerRadius = UDim.new(0, 4)
    inputCorner.Parent = inputFrame
    local label = Instance.new("TextLabel")
    label.Parent = inputFrame
    label.BackgroundTransparency = 1
    label.Position = UDim2.new(0, 12, 0, 5)
    label.Size = UDim2.new(1, -24, 0, 15)
    label.Font = Enum.Font.Gotham
    label.Text = name
    label.TextColor3 = Color3.fromRGB(220, 220, 220)
    label.TextSize = 12
    label.TextXAlignment = Enum.TextXAlignment.Left
    local inputBox = Instance.new("TextBox")
    inputBox.Parent = inputFrame
    inputBox.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
    inputBox.BorderSizePixel = 0
    inputBox.Position = UDim2.new(0, 12, 0, 24)
    inputBox.Size = UDim2.new(1, -24, 0, 16)
    inputBox.Font = Enum.Font.Gotham
    inputBox.PlaceholderText = "0-100"
    inputBox.Text = tostring(default)
    inputBox.TextColor3 = Color3.fromRGB(200, 200, 200)
    inputBox.TextSize = 11
    inputBox.ClearTextOnFocus = false
    local inputBoxCorner = Instance.new("UICorner")
    inputBoxCorner.CornerRadius = UDim.new(0, 3)
    inputBoxCorner.Parent = inputBox
    local inputPadding = Instance.new("UIPadding")
    inputPadding.PaddingLeft = UDim.new(0, 6)
    inputPadding.PaddingRight = UDim.new(0, 6)
    inputPadding.Parent = inputBox
    inputBox.FocusLost:Connect(function(enterPressed)
        local value = tonumber(inputBox.Text)
        if value then
            value = math.clamp(value, 0, 100)
            inputBox.Text = tostring(value)
            callback(value)
        else
            inputBox.Text = tostring(default)
        end
    end)
    return inputFrame
end

local function CreateLabel(text, parent)
    local labelFrame = Instance.new("Frame")
    labelFrame.Parent = parent
    labelFrame.BackgroundColor3 = Color3.fromRGB(22, 22, 22)
    labelFrame.BorderSizePixel = 0
    labelFrame.Size = UDim2.new(1, 0, 0, 28)
    local labelCorner = Instance.new("UICorner")
    labelCorner.CornerRadius = UDim.new(0, 4)
    labelCorner.Parent = labelFrame
    local label = Instance.new("TextLabel")
    label.Parent = labelFrame
    label.BackgroundTransparency = 1
    label.Size = UDim2.new(1, -24, 1, 0)
    label.Position = UDim2.new(0, 12, 0, 0)
    label.Font = Enum.Font.Gotham
    label.Text = text
    label.TextColor3 = Color3.fromRGB(180, 180, 180)
    label.TextSize = 11
    label.TextXAlignment = Enum.TextXAlignment.Left
    label.TextWrapped = true
    return labelFrame, label
end

local function GetRainbowColor()
    State.RainbowHue = (State.RainbowHue + 0.001) % 1
    return Color3.fromHSV(State.RainbowHue, 1, 1)
end

local function GetRandomBodyPart(character)
    local bodyParts = {}
    if Config.UseCustomParts and #Config.CustomTargetParts > 0 then
        for _, partName in ipairs(Config.CustomTargetParts) do
            if character:FindFirstChild(partName) then table.insert(bodyParts, partName) end
        end
    else
        local standardParts = {"Head", "HumanoidRootPart", "Torso", "UpperTorso", "LowerTorso", "Left Arm", "Right Arm", "Left Leg", "Right Leg"}
        for _, p in ipairs(standardParts) do
            if character:FindFirstChild(p) then table.insert(bodyParts, p) end
        end
    end
    if #bodyParts > 0 then return bodyParts[math.random(1, #bodyParts)] end
    return "Head"
end

local function CreateMultiToggle(name, options, parent)
    local multiToggleFrame = Instance.new("Frame")
    multiToggleFrame.Name = name .. "MultiToggle"
    multiToggleFrame.Parent = parent
    multiToggleFrame.BackgroundColor3 = Color3.fromRGB(22, 22, 22)
    multiToggleFrame.BorderSizePixel = 0
    multiToggleFrame.Size = UDim2.new(1, 0, 0, 25 + (#options * 28))
    local multiToggleCorner = Instance.new("UICorner")
    multiToggleCorner.CornerRadius = UDim.new(0, 4)
    multiToggleCorner.Parent = multiToggleFrame
    local titleLabel = Instance.new("TextLabel")
    titleLabel.Parent = multiToggleFrame
    titleLabel.BackgroundTransparency = 1
    titleLabel.Position = UDim2.new(0, 12, 0, 5)
    titleLabel.Size = UDim2.new(1, -24, 0, 15)
    titleLabel.Font = Enum.Font.GothamBold
    titleLabel.Text = name
    titleLabel.TextColor3 = Color3.fromRGB(220, 220, 220)
    titleLabel.TextSize = 12
    titleLabel.TextXAlignment = Enum.TextXAlignment.Left
    for i, option in ipairs(options) do
        local optionFrame = Instance.new("Frame")
        optionFrame.Parent = multiToggleFrame
        optionFrame.BackgroundTransparency = 1
        optionFrame.Position = UDim2.new(0, 12, 0, 20 + ((i - 1) * 28))
        optionFrame.Size = UDim2.new(1, -24, 0, 24)
        local optionLabel = Instance.new("TextLabel")
        optionLabel.Parent = optionFrame
        optionLabel.BackgroundTransparency = 1
        optionLabel.Size = UDim2.new(0.7, 0, 1, 0)
        optionLabel.Font = Enum.Font.Gotham
        optionLabel.Text = option
        optionLabel.TextColor3 = Color3.fromRGB(180, 180, 180)
        optionLabel.TextSize = 11
        optionLabel.TextXAlignment = Enum.TextXAlignment.Left
        local checkbox = Instance.new("TextButton")
        checkbox.Parent = optionFrame
        checkbox.BackgroundColor3 = Color3.fromRGB(35, 35, 35)
        checkbox.BorderSizePixel = 0
        checkbox.Position = UDim2.new(1, -35, 0.5, -8)
        checkbox.Size = UDim2.new(0, 35, 0, 16)
        checkbox.Font = Enum.Font.GothamBold
        checkbox.Text = "OFF"
        checkbox.TextColor3 = Color3.fromRGB(120, 120, 120)
        checkbox.TextSize = 9
        checkbox.AutoButtonColor = false
        local checkboxCorner = Instance.new("UICorner")
        checkboxCorner.CornerRadius = UDim.new(0, 3)
        checkboxCorner.Parent = checkbox
        local isEnabled = false
        checkbox.MouseButton1Click:Connect(function()
            isEnabled = not isEnabled
            checkbox.Text = isEnabled and "ON" or "OFF"
            checkbox.BackgroundColor3 = isEnabled and Color3.fromRGB(60, 60, 60) or Color3.fromRGB(35, 35, 35)
            checkbox.TextColor3 = isEnabled and Color3.fromRGB(200, 200, 200) or Color3.fromRGB(120, 120, 120)
            if isEnabled then
                if not table.find(Config.CustomTargetParts, option) then table.insert(Config.CustomTargetParts, option) end
            else
                local index = table.find(Config.CustomTargetParts, option)
                if index then table.remove(Config.CustomTargetParts, index) end
            end
        end)
    end
    return multiToggleFrame
end

local function CreatePlayerList(name, parent, onAddCallback, onRemoveCallback)
    local listFrame = Instance.new("Frame")
    listFrame.Name = name .. "List"
    listFrame.Parent = parent
    listFrame.BackgroundColor3 = Color3.fromRGB(22, 22, 22)
    listFrame.BorderSizePixel = 0
    listFrame.Size = UDim2.new(1, 0, 0, 180)
    local listCorner = Instance.new("UICorner")
    listCorner.CornerRadius = UDim.new(0, 4)
    listCorner.Parent = listFrame
    local titleLabel = Instance.new("TextLabel")
    titleLabel.Parent = listFrame
    titleLabel.BackgroundTransparency = 1
    titleLabel.Position = UDim2.new(0, 12, 0, 5)
    titleLabel.Size = UDim2.new(1, -24, 0, 15)
    titleLabel.Font = Enum.Font.GothamBold
    titleLabel.Text = name
    titleLabel.TextColor3 = Color3.fromRGB(220, 220, 220)
    titleLabel.TextSize = 12
    titleLabel.TextXAlignment = Enum.TextXAlignment.Left
    local scrollFrame = Instance.new("ScrollingFrame")
    scrollFrame.Parent = listFrame
    scrollFrame.BackgroundColor3 = Color3.fromRGB(18, 18, 18)
    scrollFrame.BorderSizePixel = 0
    scrollFrame.Position = UDim2.new(0, 8, 0, 25)
    scrollFrame.Size = UDim2.new(1, -16, 0, 105)
    scrollFrame.ScrollBarThickness = 3
    scrollFrame.CanvasSize = UDim2.new(0, 0, 0, 0)
    scrollFrame.ScrollBarImageColor3 = Color3.fromRGB(80, 80, 80)
    local scrollCorner = Instance.new("UICorner")
    scrollCorner.CornerRadius = UDim.new(0, 4)
    scrollCorner.Parent = scrollFrame
    local listLayout = Instance.new("UIListLayout")
    listLayout.Parent = scrollFrame
    listLayout.SortOrder = Enum.SortOrder.LayoutOrder
    listLayout.Padding = UDim.new(0, 4)
    listLayout:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(function()
        scrollFrame.CanvasSize = UDim2.new(0, 0, 0, listLayout.AbsoluteContentSize.Y + 5)
    end)
    local inputBox = Instance.new("TextBox")
    inputBox.Parent = listFrame
    inputBox.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
    inputBox.BorderSizePixel = 0
    inputBox.Position = UDim2.new(0, 8, 0, 137)
    inputBox.Size = UDim2.new(1, -80, 0, 30)
    inputBox.Font = Enum.Font.Gotham
    inputBox.PlaceholderText = "Player name..."
    inputBox.Text = ""
    inputBox.TextColor3 = Color3.fromRGB(200, 200, 200)
    inputBox.TextSize = 11
    inputBox.TextXAlignment = Enum.TextXAlignment.Left
    inputBox.ClearTextOnFocus = false
    local inputCorner = Instance.new("UICorner")
    inputCorner.CornerRadius = UDim.new(0, 4)
    inputCorner.Parent = inputBox
    local inputPadding = Instance.new("UIPadding")
    inputPadding.PaddingLeft = UDim.new(0, 8)
    inputPadding.Parent = inputBox
    local addButton = Instance.new("TextButton")
    addButton.Parent = listFrame
    addButton.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
    addButton.BorderSizePixel = 0
    addButton.Position = UDim2.new(1, -68, 0, 137)
    addButton.Size = UDim2.new(0, 60, 0, 30)
    addButton.Font = Enum.Font.GothamBold
    addButton.Text = "ADD"
    addButton.TextColor3 = Color3.fromRGB(200, 200, 200)
    addButton.TextSize = 11
    addButton.AutoButtonColor = false
    local addCorner = Instance.new("UICorner")
    addCorner.CornerRadius = UDim.new(0, 4)
    addCorner.Parent = addButton
    local function createPlayerEntry(playerName)
        local entryFrame = Instance.new("Frame")
        entryFrame.Parent = scrollFrame
        entryFrame.BackgroundColor3 = Color3.fromRGB(28, 28, 28)
        entryFrame.BorderSizePixel = 0
        entryFrame.Size = UDim2.new(1, -5, 0, 22)
        local entryCorner = Instance.new("UICorner")
        entryCorner.CornerRadius = UDim.new(0, 3)
        entryCorner.Parent = entryFrame
        local nameLabel = Instance.new("TextLabel")
        nameLabel.Parent = entryFrame
        nameLabel.BackgroundTransparency = 1
        nameLabel.Position = UDim2.new(0, 8, 0, 0)
        nameLabel.Size = UDim2.new(1, -35, 1, 0)
        nameLabel.Font = Enum.Font.Gotham
        nameLabel.Text = playerName
        nameLabel.TextColor3 = Color3.fromRGB(200, 200, 200)
        nameLabel.TextSize = 10
        nameLabel.TextXAlignment = Enum.TextXAlignment.Left
        nameLabel.TextTruncate = Enum.TextTruncate.AtEnd
        local removeButton = Instance.new("TextButton")
        removeButton.Parent = entryFrame
        removeButton.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
        removeButton.BorderSizePixel = 0
        removeButton.Position = UDim2.new(1, -24, 0.5, -9)
        removeButton.Size = UDim2.new(0, 20, 0, 18)
        removeButton.Font = Enum.Font.GothamBold
        removeButton.Text = "Ã—"
        removeButton.TextColor3 = Color3.fromRGB(180, 180, 180)
        removeButton.TextSize = 14
        removeButton.AutoButtonColor = false
        local removeCorner = Instance.new("UICorner")
        removeCorner.CornerRadius = UDim.new(0, 3)
        removeCorner.Parent = removeButton
        removeButton.MouseButton1Click:Connect(function()
            entryFrame:Destroy()
            if onRemoveCallback then onRemoveCallback(playerName) end
        end)
        return entryFrame
    end
    addButton.MouseButton1Click:Connect(function()
        local playerName = inputBox.Text:gsub("^%s*(.-)%s*$", "%1")
        if playerName ~= "" then
            local isDuplicate = false
            for _, child in ipairs(scrollFrame:GetChildren()) do
                if child:IsA("Frame") and child:FindFirstChild("TextLabel") and child.TextLabel.Text == playerName then isDuplicate = true break end
            end
            if not isDuplicate then
                createPlayerEntry(playerName)
                if onAddCallback then onAddCallback(playerName) end
                inputBox.Text = ""
            end
        end
    end)
    inputBox.FocusLost:Connect(function(enterPressed) if enterPressed then addButton.MouseButton1Click:Fire() end end)
    return listFrame
end

-- Build UI
local AimbotTab = CreateTab("AIMBOT")
local VisualsTab = CreateTab("VISUALS")
local PredictionTab = CreateTab("PREDICT")
local SettingsTab = CreateTab("SETTINGS")
local InfoTab = CreateTab("INFO")

-- Aimbot Tab Content
CreateSection("MAIN", AimbotTab.Content)
CreateToggle("Aimbot", false, function(value) State.AimbotActive = value end, AimbotTab.Content)
CreateToggle("Team Check", false, function(value) Config.TeamCheck = value end, AimbotTab.Content)
CreateToggle("Wall Check", true, function(value) Config.WallCheck = value end, AimbotTab.Content)
CreateToggle("Ignore Dead", true, function(value) Config.IgnoreDeadPlayers = value end, AimbotTab.Content)

CreateSection("RANDOM", AimbotTab.Content)
CreateToggle("Random Part", false, function(value) 
    Config.RandomTargetPart = value 
    State.CurrentRandomPart = nil
    State.LastTargetPlayer = nil
    State.LastRandomPartUpdate = 0
end, AimbotTab.Content)

CreateToggle("Use Custom Parts", false, function(value)
    Config.UseCustomParts = value
    State.CurrentRandomPart = nil
    State.LastTargetPlayer = nil
end, AimbotTab.Content)

CreateMultiToggle("Select Parts", {
    "Head",
    "HumanoidRootPart", 
    "Torso",
    "UpperTorso",
    "LowerTorso",
    "Left Arm",
    "Right Arm",
    "LeftUpperArm",
    "RightUpperArm",
    "LeftLowerArm",
    "RightLowerArm"
}, AimbotTab.Content)

CreateSlider("Interval (s)", 10, 200, Config.RandomTargetPartInterval * 100, function(value)
    Config.RandomTargetPartInterval = value / 100
end, AimbotTab.Content)

CreateSection("SETTINGS", AimbotTab.Content)
CreateSlider("Smoothness", 0, 100, Config.AimbotSmoothness * 100, function(value)
    Config.AimbotSmoothness = value / 100
end, AimbotTab.Content)

CreateSlider("FOV", 10, 500, Config.AimbotFOV, function(value)
    Config.AimbotFOV = value
    if State.FOVCircle then State.FOVCircle.Radius = value end
end, AimbotTab.Content)

-- Visuals Tab Content
CreateSection("ESP", VisualsTab.Content)
CreateToggle("ESP", false, function(value) State.ESPEnabled = value end, VisualsTab.Content)
CreateToggle("Boxes", true, function(value) Config.ESPBoxes = value end, VisualsTab.Content)
CreateToggle("Names", true, function(value) Config.ESPNames = value end, VisualsTab.Content)
CreateToggle("Distance", false, function(value) Config.ESPDistance = value end, VisualsTab.Content)
CreateToggle("Health", false, function(value) Config.ESPHealth = value end, VisualsTab.Content)
CreateToggle("Tracers", false, function(value) Config.ESPTracer = value end, VisualsTab.Content)

CreateSection("RAINBOW", VisualsTab.Content)
CreateToggle("Rainbow FOV", false, function(value) 
    Config.RainbowFOV = value
    if not value and State.FOVCircle then
        State.FOVCircle.Color = Config.FOVColor
    end
end, VisualsTab.Content)
CreateToggle("Rainbow ESP", false, function(value) Config.RainbowESP = value end, VisualsTab.Content)

CreateSection("CROSSHAIR", VisualsTab.Content)
CreateToggle("Show Crosshair", false, function(value) 
    Config.ShowCrosshair = value
    for _, line in pairs(State.CrosshairLines) do
        line.Visible = value
    end
end, VisualsTab.Content)

CreateSlider("Size", 5, 30, Config.CrosshairSize, function(value)
    Config.CrosshairSize = value
end, VisualsTab.Content)

CreateSlider("Thickness", 1, 5, Config.CrosshairThickness, function(value)
    Config.CrosshairThickness = value
    for _, line in pairs(State.CrosshairLines) do
        line.Thickness = value
    end
end, VisualsTab.Content)

CreateSlider("Gap", 0, 20, Config.CrosshairGap, function(value)
    Config.CrosshairGap = value
end, VisualsTab.Content)

CreateToggle("Rainbow Crosshair", false, function(value) 
    Config.RainbowCrosshair = value
    if not value then
        for _, line in pairs(State.CrosshairLines) do
            line.Color = Config.CrosshairColor
        end
    end
end, VisualsTab.Content)

-- Prediction Tab Content
CreateSection("PREDICTION", PredictionTab.Content)
CreateToggle("Auto Prediction", true, function(value) Config.AutoPrediction = value end, PredictionTab.Content)

CreateSection("INFO", PredictionTab.Content)
local predictionInfoFrame, predictionInfoLabel = CreateLabel("Prediction adjusts based on your ping", PredictionTab.Content)
local predictionValueFrame, predictionValueLabel = CreateLabel("Current: 0ms", PredictionTab.Content)

-- Settings Tab Content
CreateSection("QUICK ACCESS", SettingsTab.Content)
CreateToggle("Show Quick Aimbot", true, function(value) 
    Config.ShowQuickAccess = value
    if QuickAimbotButton then
        QuickAimbotButton.Visible = value
    end
end, SettingsTab.Content)

CreateSection("HEALTH THRESHOLD", SettingsTab.Content)
CreateToggle("Enable Health Stop", false, function(value) Config.UseHealthThreshold = value end, SettingsTab.Content)
CreateInput("Stop at Health", Config.HealthThreshold, function(value) Config.HealthThreshold = value end, SettingsTab.Content)

CreateSection("BLACKLIST", SettingsTab.Content)
CreateToggle("Enable Blacklist", false, function(value) Config.UseBlacklist = value end, SettingsTab.Content)
CreatePlayerList("Blacklisted Players", SettingsTab.Content, 
    function(playerName) if not table.find(Config.BlacklistedPlayers, playerName) then table.insert(Config.BlacklistedPlayers, playerName) end end,
    function(playerName) local index = table.find(Config.BlacklistedPlayers, playerName) if index then table.remove(Config.BlacklistedPlayers, index) end end
)

-- Info Tab Content
CreateSection("INFO", InfoTab.Content)
local targetLabelFrame, targetLabel = CreateLabel("Target: None", InfoTab.Content)
local targetPartLabelFrame, targetPartLabel = CreateLabel("Part: Head", InfoTab.Content)
local fpsLabelFrame, fpsLabel = CreateLabel("FPS: 0", InfoTab.Content)
local pingLabelFrame, pingLabel = CreateLabel("Ping: 0ms", InfoTab.Content)

-- Activate first tab
Tabs["AIMBOT"].Button.BackgroundColor3 = Color3.fromRGB(45, 45, 45)
Tabs["AIMBOT"].Button.TextColor3 = Color3.fromRGB(255, 255, 255)
Tabs["AIMBOT"].Content.Visible = true
CurrentTab = Tabs["AIMBOT"]

CloseButton.MouseButton1Click:Connect(function() ScreenGui:Destroy() end)
CloseButton.MouseEnter:Connect(function() CloseButton.BackgroundColor3 = Color3.fromRGB(40, 40, 40) end)
CloseButton.MouseLeave:Connect(function() CloseButton.BackgroundColor3 = Color3.fromRGB(30, 30, 30) end)

if gethui then ScreenGui.Parent = gethui() elseif syn and syn.protect_gui then syn.protect_gui(ScreenGui) ScreenGui.Parent = game.CoreGui else ScreenGui.Parent = game.CoreGui end

local ToggleButton = Instance.new("TextButton")
ToggleButton.Name = "ToggleButton"
ToggleButton.Parent = ScreenGui
ToggleButton.BackgroundColor3 = Color3.fromRGB(25, 25, 25)
ToggleButton.BorderSizePixel = 0
ToggleButton.Position = UDim2.new(0, 10, 0.5, -30)
ToggleButton.Size = UDim2.new(0, 60, 0, 60)
ToggleButton.Font = Enum.Font.GothamBold
ToggleButton.Text = ""
ToggleButton.TextColor3 = Color3.fromRGB(255, 255, 255)
ToggleButton.TextSize = 18
ToggleButton.ZIndex = 1000
ToggleButton.Active = true
ToggleButton.AutoButtonColor = false

local ToggleScale = Instance.new("UIScale")
ToggleScale.Parent = ToggleButton
ToggleScale.Scale = 1

MakeDraggable(ToggleButton, ToggleButton)

local ToggleCorner = Instance.new("UICorner")
ToggleCorner.CornerRadius = UDim.new(0, 8)
ToggleCorner.Parent = ToggleButton
local ToggleBorder = Instance.new("UIStroke")
ToggleBorder.Color = Color3.fromRGB(60, 60, 60)
ToggleBorder.Thickness = 1
ToggleBorder.Parent = ToggleButton
local ToggleLabel = Instance.new("TextLabel")
ToggleLabel.Name = "Label"
ToggleLabel.Parent = ToggleButton
ToggleLabel.BackgroundTransparency = 1
ToggleLabel.Size = UDim2.new(1, 0, 0.6, 0)
ToggleLabel.Position = UDim2.new(0, 0, 0.15, 0)
ToggleLabel.Font = Enum.Font.GothamBold
ToggleLabel.Text = "NH"
ToggleLabel.TextColor3 = Color3.fromRGB(200, 200, 200)
ToggleLabel.TextSize = 20
ToggleLabel.ZIndex = 1001
local StatusLabel = Instance.new("TextLabel")
StatusLabel.Parent = ToggleButton
StatusLabel.BackgroundTransparency = 1
StatusLabel.Size = UDim2.new(1, 0, 0.3, 0)
StatusLabel.Position = UDim2.new(0, 0, 0.65, 0)
StatusLabel.Font = Enum.Font.Gotham
StatusLabel.Text = "OPEN"
StatusLabel.TextColor3 = Color3.fromRGB(150, 150, 150)
StatusLabel.TextSize = 9
StatusLabel.ZIndex = 1001

local isVisible = true
local clickStartTime = 0
local clickThreshold = 0.2
ToggleButton.MouseButton1Down:Connect(function() clickStartTime = tick() end)
ToggleButton.MouseButton1Up:Connect(function()
    local clickDuration = tick() - clickStartTime
    if clickDuration < clickThreshold then
        isVisible = not isVisible
        MainFrame.Visible = isVisible
        StatusLabel.Text = isVisible and "OPEN" or "CLOSED"
        TweenService:Create(ToggleButton, TweenInfo.new(0.2), {BackgroundColor3 = isVisible and Color3.fromRGB(25, 25, 25) or Color3.fromRGB(35, 35, 35)}):Play()
    end
end)

QuickAimbotButton = Instance.new("TextButton")
QuickAimbotButton.Name = "QuickAimbotButton"
QuickAimbotButton.Parent = ScreenGui
QuickAimbotButton.BackgroundColor3 = Color3.fromRGB(25, 25, 25)
QuickAimbotButton.BorderSizePixel = 0
QuickAimbotButton.Position = UDim2.new(0, 10, 0.5, 40)
QuickAimbotButton.Size = UDim2.new(0, 60, 0, 60)
QuickAimbotButton.Font = Enum.Font.GothamBold
QuickAimbotButton.Text = ""
QuickAimbotButton.TextColor3 = Color3.fromRGB(255, 255, 255)
QuickAimbotButton.TextSize = 14
QuickAimbotButton.ZIndex = 1000
QuickAimbotButton.Active = true
QuickAimbotButton.Visible = Config.ShowQuickAccess
QuickAimbotButton.AutoButtonColor = false

local QuickScale = Instance.new("UIScale")
QuickScale.Parent = QuickAimbotButton
QuickScale.Scale = 1

MakeDraggable(QuickAimbotButton, QuickAimbotButton)

local QuickCorner = Instance.new("UICorner")
QuickCorner.CornerRadius = UDim.new(0, 8)
QuickCorner.Parent = QuickAimbotButton
QuickBorder = Instance.new("UIStroke")
QuickBorder.Color = Color3.fromRGB(60, 60, 60)
QuickBorder.Thickness = 1
QuickBorder.Parent = QuickAimbotButton
local QuickLabel = Instance.new("TextLabel")
QuickLabel.Name = "Label"
QuickLabel.Parent = QuickAimbotButton
QuickLabel.BackgroundTransparency = 1
QuickLabel.Size = UDim2.new(1, 0, 0.5, 0)
QuickLabel.Position = UDim2.new(0, 0, 0.15, 0)
QuickLabel.Font = Enum.Font.GothamBold
QuickLabel.Text = "ðŸŽ¯"
QuickLabel.TextColor3 = Color3.fromRGB(200, 200, 200)
QuickLabel.TextSize = 24
QuickLabel.ZIndex = 1001
QuickStatusLabel = Instance.new("TextLabel")
QuickStatusLabel.Parent = QuickAimbotButton
QuickStatusLabel.BackgroundTransparency = 1
QuickStatusLabel.Size = UDim2.new(1, 0, 0.3, 0)
QuickStatusLabel.Position = UDim2.new(0, 0, 0.65, 0)
QuickStatusLabel.Font = Enum.Font.Gotham
QuickStatusLabel.Text = "OFF"
QuickStatusLabel.TextColor3 = Color3.fromRGB(150, 150, 150)
QuickStatusLabel.TextSize = 9
QuickStatusLabel.ZIndex = 1001

local quickClickStartTime = 0
local quickClickThreshold = 0.2
QuickAimbotButton.MouseButton1Down:Connect(function() quickClickStartTime = tick() end)
QuickAimbotButton.MouseButton1Up:Connect(function()
    local clickDuration = tick() - quickClickStartTime
    if clickDuration < quickClickThreshold then
        State.AimbotActive = not State.AimbotActive
        QuickStatusLabel.Text = State.AimbotActive and "ON" or "OFF"
        QuickStatusLabel.TextColor3 = State.AimbotActive and Color3.fromRGB(150, 200, 150) or Color3.fromRGB(150, 150, 150)
        TweenService:Create(QuickAimbotButton, TweenInfo.new(0.2), {BackgroundColor3 = State.AimbotActive and Color3.fromRGB(40, 50, 40) or Color3.fromRGB(25, 25, 25)}):Play()
        TweenService:Create(QuickBorder, TweenInfo.new(0.2), {Color = State.AimbotActive and Color3.fromRGB(100, 150, 100) or Color3.fromRGB(60, 60, 60)}):Play()
    end
end)

local function UpdateScale()
    local viewport = Camera.ViewportSize
    local baseHeight = 900
    local rawScale = viewport.Y / baseHeight
    local clampedScale = math.clamp(rawScale, 0.6, 1.3)
    MainScale.Scale = clampedScale
    ToggleScale.Scale = clampedScale
    QuickScale.Scale = clampedScale
end

Camera:GetPropertyChangedSignal("ViewportSize"):Connect(UpdateScale)
UpdateScale()

local function CreateFOVCircle()
    State.FOVCircle = Drawing.new("Circle")
    State.FOVCircle.Visible = false
    State.FOVCircle.Radius = Config.AimbotFOV
    State.FOVCircle.Color = Config.FOVColor
    State.FOVCircle.Thickness = Config.FOVThickness
    State.FOVCircle.Transparency = Config.FOVTransparency
    State.FOVCircle.Filled = false
    State.FOVCircle.NumSides = 50
end

local function CreateCrosshair()
    State.CrosshairLines.Top = Drawing.new("Line")
    State.CrosshairLines.Bottom = Drawing.new("Line")
    State.CrosshairLines.Left = Drawing.new("Line")
    State.CrosshairLines.Right = Drawing.new("Line")
end

local function UpdateCrosshair()
    if not Config.ShowCrosshair then return end
    local centerX = Camera.ViewportSize.X / 2
    local centerY = Camera.ViewportSize.Y / 2
    local size = Config.CrosshairSize
    local gap = Config.CrosshairGap
    local color = Config.RainbowCrosshair and GetRainbowColor() or Config.CrosshairColor
    
    local lines = State.CrosshairLines
    lines.Top.From = Vector2.new(centerX, centerY - gap)
    lines.Top.To = Vector2.new(centerX, centerY - gap - size)
    lines.Bottom.From = Vector2.new(centerX, centerY + gap)
    lines.Bottom.To = Vector2.new(centerX, centerY + gap + size)
    lines.Left.From = Vector2.new(centerX - gap, centerY)
    lines.Left.To = Vector2.new(centerX - gap - size, centerY)
    lines.Right.From = Vector2.new(centerX + gap, centerY)
    lines.Right.To = Vector2.new(centerX + gap + size, centerY)
    
    for _, line in pairs(lines) do
        line.Color = color
        line.Thickness = Config.CrosshairThickness
        line.Transparency = Config.CrosshairTransparency
        line.Visible = true
    end
end

local function UpdateFOVCircle()
    if State.FOVCircle then
        State.FOVCircle.Visible = State.AimbotActive
        State.FOVCircle.Position = Vector2.new(Camera.ViewportSize.X / 2, Camera.ViewportSize.Y / 2)
        State.FOVCircle.Radius = Config.AimbotFOV
        if Config.RainbowFOV then State.FOVCircle.Color = GetRainbowColor() end
    end
end

local function IsVisible(targetPart)
    local origin = Camera.CFrame.Position
    local targetPos = targetPart.Position
    local direction = (targetPos - origin).Unit
    local distance = (targetPos - origin).Magnitude
    local raycastParams = RaycastParams.new()
    raycastParams.FilterDescendantsInstances = {LocalPlayer.Character, targetPart.Parent}
    raycastParams.FilterType = Enum.RaycastFilterType.Blacklist
    local raycastResult = workspace:Raycast(origin, direction * distance, raycastParams)
    return not raycastResult
end

local function GetPlayerPing()
    return game:GetService("Stats").Network.ServerStatsItem["Data Ping"]:GetValue() / 1000
end

local function GetNearestPlayerInFOV()
    local nearestDistance, nearestPlayer = math.huge, nil
    local screenCenter = Vector2.new(Camera.ViewportSize.X / 2, Camera.ViewportSize.Y / 2)

    for _, player in pairs(Players:GetPlayers()) do
        if player ~= LocalPlayer and player.Character and player.Character:FindFirstChild("Humanoid") and player.Character:FindFirstChild("HumanoidRootPart") then
            if Config.UseBlacklist and table.find(Config.BlacklistedPlayers, player.Name) then continue end
            
            local humanoid = player.Character.Humanoid
            if (not Config.IgnoreDeadPlayers or humanoid.Health > 0) then
                if Config.UseHealthThreshold and humanoid.Health <= Config.HealthThreshold then continue end
                if Config.TeamCheck and player.Team == LocalPlayer.Team then continue end
                
                local partToCheck = "Head"
                local targetPart = player.Character:FindFirstChild(partToCheck)
                if targetPart then
                    local screenPos, onScreen = Camera:WorldToScreenPoint(targetPart.Position)
                    if onScreen then
                        local distanceFromCenter = (Vector2.new(screenPos.X, screenPos.Y) - screenCenter).Magnitude
                        if distanceFromCenter <= Config.AimbotFOV then
                            local distance = (targetPart.Position - Camera.CFrame.Position).Magnitude
                            if distance < nearestDistance then
                                if not Config.WallCheck or IsVisible(targetPart) then
                                    nearestDistance, nearestPlayer = distance, player
                                end
                            end
                        end
                    end
                end
            end
        end
    end
    return nearestPlayer
end

local function UpdateESP()
    for player, esp in pairs(State.ESPObjects) do
        if player.Character and player.Character:FindFirstChild("HumanoidRootPart") and player.Character:FindFirstChild("Humanoid") then
            local hrp = player.Character.HumanoidRootPart
            local humanoid = player.Character.Humanoid
            local vector, onScreen = Camera:WorldToViewportPoint(hrp.Position)
            local distance = (hrp.Position - Camera.CFrame.Position).Magnitude
            local espColor = Config.RainbowESP and GetRainbowColor() or (Config.TeamCheck and (player.Team == LocalPlayer.Team and Config.TeamColor or Config.EnemyColor) or Config.EnemyColor)

            if onScreen and distance <= Config.MaxESPDistance and State.ESPEnabled then
                if Config.ESPBoxes then
                    local rootPos = Camera:WorldToViewportPoint(hrp.Position)
                    local headPos = Camera:WorldToViewportPoint(hrp.Position + Vector3.new(0, 3, 0))
                    local legPos = Camera:WorldToViewportPoint(hrp.Position - Vector3.new(0, 3, 0))
                    esp.Box.Size = Vector2.new(2000 / rootPos.Z, headPos.Y - legPos.Y)
                    esp.Box.Position = Vector2.new(rootPos.X - esp.Box.Size.X / 2, rootPos.Y - esp.Box.Size.Y / 2)
                    esp.Box.Color = espColor
                    esp.Box.Visible = true
                else esp.Box.Visible = false end
                
                if Config.ESPNames then
                    esp.Name.Text = player.Name
                    esp.Name.Position = Vector2.new(vector.X, vector.Y - 40)
                    esp.Name.Color = espColor
                    esp.Name.Visible = true
                else esp.Name.Visible = false end
                
                if Config.ESPDistance then
                    esp.Distance.Text = string.format("%.0f m", distance)
                    esp.Distance.Position = Vector2.new(vector.X, vector.Y + 40)
                    esp.Distance.Color = espColor
                    esp.Distance.Visible = true
                else esp.Distance.Visible = false end
                
                if Config.ESPHealth then
                    esp.Health.Text = string.format("%.0f HP", humanoid.Health)
                    esp.Health.Position = Vector2.new(vector.X, vector.Y + 60)
                    esp.Health.Color = espColor
                    esp.Health.Visible = true
                else esp.Health.Visible = false end
                
                if Config.ESPTracer then
                    esp.Tracer.From = Vector2.new(Camera.ViewportSize.X / 2, Camera.ViewportSize.Y)
                    esp.Tracer.To = Vector2.new(vector.X, vector.Y)
                    esp.Tracer.Color = espColor
                    esp.Tracer.Visible = true
                else esp.Tracer.Visible = false end
            else
                for _, object in pairs(esp) do object.Visible = false end
            end
        else
            for _, object in pairs(esp) do object.Visible = false end
        end
    end
end

local function UpdateFPS()
    frameCount = frameCount + 1
    local currentTime = tick()
    local elapsed = currentTime - lastUpdate
    if elapsed >= 1 then
        fpsLabel.Text = "FPS: " .. math.floor(frameCount / elapsed)
        frameCount = 0
        lastUpdate = currentTime
    end
end

local function UpdatePing()
    pingLabel.Text = "Ping: " .. math.floor(GetPlayerPing() * 1000) .. "ms"
end

CreateFOVCircle()
CreateCrosshair()

-- !!! KEY FIX: Use BindToRenderStep with HIGH PRIORITY to prevent Camera fighting !!!
RunService:BindToRenderStep("NurkHubAimbot", Enum.RenderPriority.Camera.Value + 1, function()
    UpdateFOVCircle()
    UpdateCrosshair()
    UpdateESP()
    UpdatePing()
    UpdateFPS()
    
    if State.AimbotActive then
        State.TargetPlayer = GetNearestPlayerInFOV()
        if State.TargetPlayer then
            targetLabel.Text = "Target: " .. State.TargetPlayer.Name
            local targetPartName = Config.AimbotTargetPart
            
            if Config.RandomTargetPart then
                local currentTime = tick()
                if State.TargetPlayer ~= State.LastTargetPlayer or (currentTime - State.LastRandomPartUpdate >= Config.RandomTargetPartInterval) then
                    State.CurrentRandomPart = GetRandomBodyPart(State.TargetPlayer.Character)
                    State.LastRandomPartUpdate = currentTime
                    State.LastTargetPlayer = State.TargetPlayer
                end
                targetPartName = State.CurrentRandomPart or Config.AimbotTargetPart
            end
            
            targetPartLabel.Text = "Part: " .. targetPartName
            local targetPart = State.TargetPlayer.Character:FindFirstChild(targetPartName)
            
            if targetPart then
                 local currentHumanoid = State.TargetPlayer.Character:FindFirstChild("Humanoid")
                 if Config.UseHealthThreshold and currentHumanoid and currentHumanoid.Health <= Config.HealthThreshold then
                     State.TargetPlayer = nil
                     return
                 end
                 
                 if Config.WallCheck and not IsVisible(targetPart) then
                     targetLabel.Text = "Target: " .. State.TargetPlayer.Name .. " (Wall)"
                     State.TargetPlayer = nil
                     return
                 end
                 
                 local predictionTime = 0
                 if Config.AutoPrediction then
                     local ping = GetPlayerPing()
                     predictionTime = math.clamp(ping * 0.4, 0.01, 0.2)
                     predictionValueLabel.Text = string.format("Pred: %.0fms", predictionTime * 1000)
                 end
                 
                 local predictedPos = targetPart.Position + (targetPart.Velocity * predictionTime)
                 
                 -- Simple, robust look vector calculation
                 local currentCFrame = Camera.CFrame
                 local lookAt = CFrame.new(currentCFrame.Position, predictedPos)
                 
                 -- Fixed Smoothing Math (Linear Interpolation)
                 Camera.CFrame = currentCFrame:Lerp(lookAt, Config.AimbotSmoothness)
            end
        else
            targetLabel.Text = "Target: None"
            targetPartLabel.Text = "Part: " .. (Config.RandomTargetPart and "Random" or Config.AimbotTargetPart)
        end
    else
        targetLabel.Text = "Target: None"
    end
end)

UserInputService.InputBegan:Connect(function(input, gameProcessed)
    if not gameProcessed and input.KeyCode == Config.AimbotKey then
        State.AimbotActive = not State.AimbotActive
        QuickStatusLabel.Text = State.AimbotActive and "ON" or "OFF"
        QuickStatusLabel.TextColor3 = State.AimbotActive and Color3.fromRGB(150, 200, 150) or Color3.fromRGB(150, 150, 150)
        TweenService:Create(QuickAimbotButton, TweenInfo.new(0.2), {BackgroundColor3 = State.AimbotActive and Color3.fromRGB(40, 50, 40) or Color3.fromRGB(25, 25, 25)}):Play()
        TweenService:Create(QuickBorder, TweenInfo.new(0.2), {Color = State.AimbotActive and Color3.fromRGB(100, 150, 100) or Color3.fromRGB(60, 60, 60)}):Play()
    end
end)

Players.PlayerAdded:Connect(function(player) CreateESPObject(player) end)
Players.PlayerRemoving:Connect(function(player) RemoveESPObject(player) end)
for _, player in ipairs(Players:GetPlayers()) do if player ~= LocalPlayer then CreateESPObject(player) end end

print("Nurk Hub V1.6.6 loaded successfully!")
print("Fixed Aimbot Logic & Scrolling")
